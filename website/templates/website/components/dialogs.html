{% load static %}

<!-- Reservation Dijalog -->
<div v-if="modalOpen" class="p-2 fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-lg relative">

        <!-- Zatvori -->
        <button @click="closeReservationModal" class="absolute top-2 right-2 text-gray-500 hover:text-red-600 text-4xl">
            &times;
        </button>

        <p class="">
            <span class="font-bold text-xl">[[selectedStage.name]]</span>
            <span class="w-8 h-8 inline-flex items-center justify-center rounded-full bg-green-500 text-white font-bold ml-2 transform transition duration-300 hover:rotate-12 shadow">[[selectedCell.label]]</span>
        </p>

        <hr class="mt-2 mb-4 w-64">
        <!--        <p class=""><span class="text-xl font-bold">[[selectedCell.status_display]]</span></p>-->
        <!--        <br>-->
        <form @submit.prevent="submitReservationForm" class="space-y-4">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                <!-- Status -->

                <div>
                    <label class="block mb-1 font-semibold">Status</label>
                    <select @change="onStatusChange" v-model="reservationForm.status"
                            class="w-full border rounded px-3 py-2" required>
                        <option value="unavailable">Zauzeto</option>
                        <option value="available">Dostupno</option>
                        <option value="reserved">Rezervisano</option>
                        <option value="signature">Potpis</option>
                    </select >
                </div>

                <!-- Cena -->
                <div v-if="reservationForm.status !== 'available' && reservationForm.status !== 'signature'">
                    <label class="block mb-1 font-semibold">Cena</label>
                    <input type="number" v-model="reservationForm.price" class="w-full border rounded px-3 py-2" required/>
                </div>
            </div>
            <!-- Prikaz datuma samo ako je "reserved" -->
            <div v-if="reservationForm.status === 'reserved'" class="mt-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <div class="mb-2">
                        <label class="block mb-1 font-semibold">Datum od</label>
                        <input type="date" v-model="reservationForm.date_from" class="w-full border rounded px-3 py-2" required/>
                    </div>
                    <div>
                        <label class="block mb-1 font-semibold">Datum do</label>
                        <input type="date" v-model="reservationForm.date_to" class="w-full border rounded px-3 py-2" required/>
                    </div>
                </div>

            </div>

            <!-- Detalji -->
            <div v-if="selectedCell.reservation" class="flex flex-col gap-2 mt-6">
                <div
                        v-for="(detail, index) in selectedCell.reservation.details"
                        :key="index"

                >
                    <div class="flex w-full gap-2">
                        <div class="w-full border-l-4 border-l-green-400 shadow rounded p-3 bg-white text-sm text-gray-800">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold">[[ index + 1 ]]. [[ detail.user_display ]]</span>
                                <span class="text-xs text-gray-500">[[ detail.status_display ]]</span>
                            </div>
                            <div class="flex justify-between items-center text-xs text-gray-600">
                                <span>[[ detail.reserved_at ]]</span>
                                <span v-if="detail.price != 0"
                                      class="font-bold text-green-600">[[ detail.price ]] €</span>
                            </div>
                        </div>
                        <div v-if="user.role == 'admin' || user.role == 'moderator'">
                            <div class="flex justify-center items-center ">
                                <span @click="deleteDetails(detail.id)"
                                      class="bg-red-400 p-3 text-white rounded cursor-pointer hover:bg-red-200">X</span>
                            </div>
                        </div>
                    </div>

                </div>


            </div>


            <div class="text-right">
                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    Dodaj
                </button>
            </div>
        </form>


        <!-- Logovi -->
        <!--        <div class="mt-6">-->
        <!--            <h3 class="text-lg font-bold mb-2">Logovi</h3>-->
        <!--            <ul class="max-h-40 overflow-y-auto border rounded p-2 space-y-1 text-sm text-gray-700">-->
        <!--                <li v-for="(log, index) in logs" :key="index">• [[ log ]]</li>-->
        <!--            </ul>-->
        <!--        </div>-->
    </div>
</div>


<!-- Default Approve Dialog -->
<div v-if="dialogVisible" class="p-5 fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded shadow-lg p-6 max-w-sm w-full">
        <h2 class="text-lg font-semibold mb-4">[[ dialogTitle ]]</h2>
        <p class="mb-6">[[ dialogMessage ]]</p>
        <div class="flex justify-end space-x-4">
            <button @click="cancelDialog" class="px-4 py-2 rounded border border-gray-400 hover:bg-gray-100">NE</button>
            <button @click="confirmDialog" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-800">DA
            </button>
        </div>
    </div>
</div>


<div v-if="user.role == 'admin' || user.role == 'moderator'">

    <!-- Menu -->
    <div class="flex flex-col justify-between">
        <div
                class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-xl border-l-2 rounded-l-xl border-green-200 p-6 z-40 transition-transform duration-300 ease-in-out"
                :class="showRevenue ? 'translate-x-0' : 'translate-x-full'"
        >
            <div class="">
                <div class="text-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Prihod za dan</h2>
                    <p class="text-gray-500 text-sm">[[ revenue.date ]]</p>
                </div>

                <div class="mt-4 divide-y divide-gray-100">
                    <div class="flex justify-between py-2">
                        <span class="text-gray-600">Stage A</span>
                        <span class="font-medium text-gray-900">[[ revenue.A ]] €</span>
                    </div>
                    <div class="flex justify-between py-2">
                        <span class="text-gray-600">Stage B</span>
                        <span class="font-medium text-gray-900">[[ revenue.B ]] €</span>
                    </div>
                    <div class="flex justify-between py-2">
                        <span class="text-gray-600">Stage C</span>
                        <span class="font-medium text-gray-900">[[ revenue.C ]] €</span>
                    </div>
                    <div class="flex justify-between py-2">
                        <span class="text-gray-600">Stage D</span>
                        <span class="font-medium text-gray-900">[[ revenue.D ]] €</span>
                    </div>
                </div>

                <div class="mt-4 border-t pt-4 flex justify-between text-lg font-semibold text-gray-800">
                    <span>Ukupno</span>
                    <span>[[ revenue.total_income ]] €</span>
                </div>
            </div>
        </div>

    </div>

</div>


<!--Dialog za notifikacije-->
<div v-if="notification.show"
     :class="[
        'fixed top-5 right-5 z-50 px-4 py-2 rounded shadow text-white transition',
        notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'
     ]">
    [[ notification.message ]]
</div>
